<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quejas</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/forms.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=Inknut+Antiqua:wght@300;400;500;600;700;800;900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Jomolhari&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
</head>
<body>
  <div class="div_center">
     <form class="form" id="form" method="POST" action="/api/report" enctype="multipart/form-data">
        <div class="div_sub_container_form">
          <a href="/complaint" class="button_back">
            <div class="button_back_box">
              <span class="button_elem">
                <svg viewBox="0 0 46 40" xmlns="http://www.w3.org/2000/svg">
                  <path d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"></path>
                </svg>
              </span>
              <span class="button-elem">
                <svg viewBox="0 0 46 40">
                  <path d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"></path>
                </svg>
              </span>
            </div>
          </a>
          <p class="title">Crear queja</p>
        </div>

        <label>
          <input name="name" required placeholder="" type="text" class="input" />
          <span>Título</span>
        </label>

        <label>
          <input name="description" required placeholder="" type="text" class="input" />
          <span>Descripción</span>
        </label>

        <label>
          <input name="address" required placeholder="" type="text" class="input" />
          <span>Lugar</span>
        </label>

        <select name="type" class="custom-select" required>
          <option value="" disabled selected>Selecciona el tipo de queja</option>
          <option value="noise">Ruido excesivo</option>
          <option value="trash">Acumulación de basura</option>
          <option value="secure">Problema de seguridad</option>
          <option value="infraestructure">Daño en infraestructura</option>
          <option value="others">Otro</option>
        </select>

        <button type="submit" class="button button_color_primary">Crear Queja</button>
      </form>
    </div>
  </div>

  <footer class="footer">
    <!-- Tu footer aquí -->
  </footer>

  <script>
    document.getElementById('form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const userId = "66b7fcb98d89f13c8c4a3a45"; // <-- Reemplaza con el ID real del usuario
      const form = e.target;

      const data = {
        name: form.name.value,
        description: form.description.value,
        address: form.address.value,
        type: form.type.value,
        user: userId,
        date: new Date().toISOString()
      };

      try {
        const res = await fetch('/report/create-report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!res.ok) {
          const err = await res.json();
          alert('Error: ' + (err.message || 'Error desconocido'));
          return;
        }

        const result = await res.json();
        alert('Queja creada con éxito');
        if (result.redirect) {
          window.location.href = result.redirect;
        } else {
          window.location.href = '/dashboard';
        }
      } catch (error) {
        console.error(error);
        alert('Error al enviar la queja');
      }
    });
  </script>
</body>
</html>
